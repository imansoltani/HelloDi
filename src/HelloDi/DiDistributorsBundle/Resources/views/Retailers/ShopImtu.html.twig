{% extends 'HelloDiDiDistributorsBundle:Menu:AdminRetailer.html.twig' %}

{% block title %}
    {{ 'IMTU' | trans ({}, "item") }}
{% endblock title %}

{% set MU = 'imtu' %}

{% block Site_Map %}
    <a class="link" href="{{ path('retailers_dashboard') }}">{{ 'Home' | trans ({}, "menu") }}  </a>
    <span class="link">{{ 'IMTU' | trans ({}, "item") }} </span>
{% endblock Site_Map %}

{% block PageTitle %}
    <i class="icon-mobile-phone"></i>
    {{ 'IMTU' | trans ({}, "item") }}
{% endblock %}

{% block Body %}
    <div class="span">
        <div class="widget stacked">

            <div class="widget-content">

                <form action="{{ path('Retailer_Shop_buy_Imtu') }}" method="post" class="form-horizontal" target="_blank">

                    <div class="control-group">
                        <label class="control-label" for="number">{{ 'Receiver mobile number'|trans({},'item') }}</label>
                        <div class="controls money">
                            <input type="text" name="receiverMobileNumber" id="number" onblur="readNumber()"
                                   onkeydown="return ( event.ctrlKey || event.altKey
                            || (47<event.keyCode && event.keyCode<58 && event.shiftKey==false)
                            || (95<event.keyCode && event.keyCode<106)
                            || (event.keyCode==8) || (event.keyCode==9) || (event.keyCode==107)
                            || (event.keyCode>34 && event.keyCode<40)
                            || (event.keyCode==46 || event.keyCode==116 || event.keyCode==190 || event.keyCode==110)
                            || (event.shiftKey && event.keyCode==61))">
                            <span class="icon-certificate"></span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label" for="operator">{{ 'Operator'|trans({},'operator') }}</label>
                        <div class="controls">
                            <select id="operator" onchange="readNumber()" name="operator">
                                <option value="">Select Operator manually</option>
                                {% for operator in operators %}
                                    <option value="{{ operator.id }}">{{ operator.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="hideForm wait">

                        <!-- widget-header -->
                        <div class="widget-header">
                            <h3>{{ 'Info' | trans ({}, "item") }}</h3>
                        </div>
                        <!-- /widget-header -->
                        <div class="control-group">
                            <label class="control-label" for="denomination">{{ 'denomination'|trans({},'price') }}</label>
                            <div class="controls money">
                                <select id="denomination" required="required" name="denomination"></select>
                                <span class="icon-certificate"></span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="senderMobileNumber">{{ 'Sender mobile number'|trans({},'item') }}</label>
                            <div class="controls money">
                                <input id="senderMobileNumber" name="senderMobileNumber" required="required" onkeydown="return ( event.ctrlKey || event.altKey
                            || (47<event.keyCode && event.keyCode<58 && event.shiftKey==false)
                            || (95<event.keyCode && event.keyCode<106)
                            || (event.keyCode==8) || (event.keyCode==9) || (event.keyCode==107)
                            || (event.keyCode>34 && event.keyCode<40)
                            || (event.keyCode==46 || event.keyCode==116 || event.keyCode==190 || event.keyCode==110)
                            || (event.shiftKey && event.keyCode==61))" type="text">
                                <span class="icon-certificate"></span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label" for="email">{{ 'email'|trans({},'user') }}</label>
                            <div class="controls money">
                                <input id="email" name="email" required="required" type="email">
                                <span class="icon-certificate"></span>
                            </div>
                        </div>

                        <div class="form-actions" style="margin-bottom: 0">
                            <input type="submit" class="btn btn-primary" value="{{ 'Add' | trans ({}, "common") }}"/>
                        </div>

                        <div id="loading_div" class="FormLoader">
                            <div id="error_myform"></div>
                        </div>

                    </div>

                </form>


            </div>
        </div>
    </div>

    <script type="text/javascript">
        function readNumber()
        {
            $("#error_myform").hide();
            $(".hideForm").removeClass("wait").addClass("load");
            var number = $("#number").val();
            var operator = $("#operator").val();

            if(number.length>6)
                $.ajax({
                    type: "Post",
                    url: "{{ path("Retailer_Shop_Read_Number_imtu") }}",
                    data: {"receiver":number, "operator":operator},
                    cache: false,
                    success: function(result)
                    {
                        $(".hideForm").removeClass("wait load");
                        switch (result)
                        {
                            case "not found":
                                $(".hideForm").addClass("wait");
                                $("#error_myform").text("Receiver mobile number is not found.").show();
                                break;
                            case "invalid":
                                $(".hideForm").addClass("wait");
                                $("#error_myform").text("Receiver mobile number is invalid.").show();
                                break;
                            default:
                                $("#denomination").html(result);
                        }
                    }
                });
            else
            {
                $(".hideForm").removeClass("load").addClass("wait");
                $("#error_myform").text("Receiver mobile number is invalid.").show();
            }
        }
    </script>
{% endblock %}